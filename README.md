# Hierarchical Planner with Gemini AI

A Python application that breaks down high-level goals into structured, actionable steps using Google's Gemini AI model. This tool creates a hierarchical planning structure (Phases -> Tasks -> Steps) suitable for guiding autonomous agents or project planning. It includes configuration management, logging, error handling, an optional QA validation step, and unit tests.

## Features

- Utilizes Google's Gemini models (configurable, e.g., `gemini-2.5-pro-exp-03-25`) for intelligent task breakdown.
- Generates a comprehensive hierarchical planning structure (Phases, Tasks, Steps).
- Outputs results as structured JSON files (`reasoning_tree.json`).
- **Optional QA Validation**: Analyzes the generated plan for structural integrity, goal alignment, clarity, and resource identification using Gemini, outputting an annotated plan (`reasoning_tree_validated.json`).
- **Configuration**: Manages API keys, model parameters, file paths, and logging settings via `hierarchical_planner/config/config.yaml`.
- **Logging**: Implements configurable logging to console and/or file (`hierarchical_planner/logs/planner.log`).
- **Error Handling**: Includes custom exceptions and retry mechanisms for API calls and file operations.
- **Unit Tests**: Provides `pytest` unit tests for core components.

## Project Structure

```
gemini/
├── .env                  # (Optional/Recommended) For storing GEMINI_API_KEY
├── .gitignore
├── README.md
└── hierarchical_planner/
    ├── config/
    │   ├── config.yaml   # Main configuration file
    │   └── .gitkeep
    ├── logs/             # Log files (ignored by git)
    │   └── .gitkeep
    ├── tests/            # Unit tests
    │   ├── test_config_loader.py
    │   ├── test_gemini_client.py
    │   ├── test_main.py
    │   ├── test_qa_validator.py
    │   └── .gitkeep
    ├── config_loader.py  # Loads configuration
    ├── exceptions.py     # Custom exception classes
    ├── gemini_client.py  # Handles Gemini API interaction
    ├── logger_setup.py   # Configures logging
    ├── main.py           # Main script execution and workflow orchestration
    ├── qa_validator.py   # QA validation and annotation logic
    ├── requirements-dev.txt # Dependencies for testing/development
    ├── requirements.txt  # Core application dependencies
    └── task.txt          # Input file for the high-level goal
```

## Installation

1.  **Clone the repository:**
    ```bash
    # Replace with the actual repository URL if applicable
    git clone https://github.com/yourusername/gemini.git
    cd gemini
    ```

2.  **Create and activate a virtual environment:**
    ```bash
    python -m venv venv
    # On Windows
    venv\Scripts\activate
    # On macOS/Linux
    source venv/bin/activate
    ```

3.  **Install dependencies:**
    ```bash
    # Install core dependencies
    pip install -r hierarchical_planner/requirements.txt
    # Install development/testing dependencies (optional, for running tests)
    pip install -r hierarchical_planner/requirements-dev.txt
    ```

4.  **Configure the application:**
    *   **API Key:** The recommended way is to create a `.env` file in the project root (`gemini/`) and add your key:
        ```dotenv
        GEMINI_API_KEY=YOUR_API_KEY_HERE
        ```
        Alternatively, you can modify `hierarchical_planner/config/config.yaml` to include the key directly or specify a different environment variable name (see comments in `config.yaml`).
    *   **Other Settings:** Review and modify `hierarchical_planner/config/config.yaml` to adjust the Gemini model, API parameters, default file paths, or logging settings as needed.

## Usage

1.  **Define Goal:** Edit `hierarchical_planner/task.txt` with your high-level goal (e.g., "build me an IDE").

2.  **Run the Planner:** Navigate to the `hierarchical_planner` directory and run `main.py`.
    ```bash
    cd hierarchical_planner
    python main.py [OPTIONS]
    ```

3.  **Options:**
    *   `--task-file PATH`: Specify a different input task file. (Default: `task.txt`)
    *   `--output-file PATH`: Specify a different output file for the initial plan. (Default: `reasoning_tree.json`)
    *   `--validated-output-file PATH`: Specify a different output file for the QA-validated plan. (Default: `reasoning_tree_validated.json`)
    *   `--skip-qa`: Skip the QA validation and annotation step.

4.  **Examine Output:**
    *   `reasoning_tree.json`: Contains the initial plan generated by Gemini.
    *   `reasoning_tree_validated.json`: (If QA is not skipped) Contains the plan annotated with QA analysis (`qa_info` added to each step).
    *   Logs: Check the console output and/or `hierarchical_planner/logs/planner.log` (if file logging is enabled) for progress and errors.

## Running Tests

Ensure development dependencies are installed (`pip install -r hierarchical_planner/requirements-dev.txt`). Run tests from the project root directory (`gemini/`):

```bash
pytest
```

## Output Structure

The generated JSON files (`reasoning_tree.json` and `reasoning_tree_validated.json`) follow this structure:

```json
{
  "Phase Name 1": {
    "Task Name 1.1": [
      {
        "step 1": "Detailed prompt for AI agent for step 1...",
        "qa_info": { // Added by QA validation step
          "resource_analysis": {
            "external_actions": [],
            "key_entities_dependencies": ["..."],
            "technology_hints": ["..."]
          },
          "step_critique": {
            "alignment_critique": "...",
            "sequence_critique": "...",
            "clarity_critique": "..."
          }
        }
      },
      {"step 2": "Detailed prompt for AI agent for step 2..."}
      // ... more steps
    ],
    // ... more tasks
  },
  // ... more phases
}
```
*Note: `qa_info` is only present in `reasoning_tree_validated.json`.*

## Requirements

- Python 3.8+
- Google Gemini API key
- Required Python packages (see `hierarchical_planner/requirements.txt` and `hierarchical_planner/requirements-dev.txt`)

## License

MIT License (Content from original README preserved below)

Copyright (c) 2025

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

## Acknowledgments

- This project uses Google's Generative AI (Gemini) for content generation.
